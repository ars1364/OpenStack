---
##############################################################################
# OpenStack Lab - Kolla-Ansible globals.yml
#
# Adapted from production cluster (server01-05).
# Key differences from prod:
#   - IPs: 192.168.x.x (lab) instead of 172.30.x.x (prod)
#   - NIC names: mgmt0/api0/ext0/oct0/stor0/tun0 (MAC-matched)
#   - Storage: LVM instead of Ceph (no external Ceph cluster in lab)
#   - TLS: disabled (no certs needed for lab)
#   - Registry: quay.cloudinative.com (Nexus proxy)
##############################################################################

workaround_ansible_issue_8743: yes
kolla_base_distro: ubuntu
openstack_release: 2025.1

# Container registry → Nexus proxy (no public internet)
docker_registry: "quay.cloudinative.com"
docker_namespace: "openstack.kolla"
docker_registry_insecure: "no"

openstack_region_name: "lab1"

# ---------------------------------------------------------------------------
# Networking
# ---------------------------------------------------------------------------

# Internal VIP (API endpoints) — on api0 / 192.168.204.0/24
kolla_internal_vip_address: "192.168.204.10"
network_interface: "api0"

# External VIP (public endpoints) — on ext0 / 192.168.206.0/24
kolla_external_vip_address: "192.168.206.10"
kolla_external_vip_interface: "ext0"

# No TLS for lab
kolla_enable_tls_internal: "no"
kolla_enable_tls_external: "no"
kolla_enable_tls_backend: "no"

# OVN networking (matching production)
neutron_plugin_agent: "ovn"
# neutron_external_interface: see bottom of file (includes Octavia bridge)
enable_neutron_provider_networks: "yes"
neutron_ovn_distributed_fip: "yes"
enable_neutron_dvr: "yes"
enable_neutron_qos: "yes"
enable_neutron_agent_ha: "yes"
enable_neutron_trunk: "yes"
enable_neutron_port_forwarding: "yes"

# Tunnel interface for Geneve/VXLAN overlay
tunnel_interface: "tun0"

# Storage interface
storage_interface: "stor0"

# ---------------------------------------------------------------------------
# Storage (LVM for lab — prod uses Ceph)
# ---------------------------------------------------------------------------

# Glance: local file backend (no Ceph in lab)
glance_backend_file: "yes"
glance_backend_ceph: "no"

# Cinder: LVM backend
enable_cinder: "yes"
enable_cinder_backend_lvm: "yes"
cinder_volume_group: "cinder-volumes"
cinder_backend_ceph: "no"
enable_cinder_backup: "no"

# ---------------------------------------------------------------------------
# Services (matching production where possible)
# ---------------------------------------------------------------------------

enable_haproxy: "yes"
enable_fluentd: "no"
enable_proxysql: "no"
enable_mariabackup: "yes"

enable_heat: "no"
enable_mistral: "yes"
enable_barbican: "yes"
enable_skyline: "yes"

enable_etcd: "yes"
enable_redis: "yes"

# Compute
nova_compute_virt_type: "kvm"

# Telemetry
enable_gnocchi: "yes"
enable_gnocchi_statsd: "no"
enable_ceilometer: "yes"
enable_ceilometer_ipmi: "no"

# Monitoring
enable_grafana: "yes"
grafana_server_port: "3000"
enable_prometheus: "yes"

# Load balancing
enable_octavia: "yes"
octavia_loadbalancer_topology: "ACTIVE_STANDBY"

octavia_amp_network:
  name: lb-mgmt-net
  provider_network_type: flat
  provider_physical_network: physnet-oct
  external: false
  shared: false
  subnet:
    name: lb-mgmt-subnet
    cidr: "192.168.202.0/24"
    allocation_pool_start: "192.168.202.100"
    allocation_pool_end: "192.168.202.200"
    gateway_ip: "192.168.202.1"
    enable_dhcp: yes

# HA
enable_masakari: "no"
enable_hacluster: "no"

# Messaging
om_enable_rabbitmq_stream_fanout: true

# Influx disabled
enable_influxdb: "no"

# Cinder HA cluster name (required with multiple cinder-volume instances)
# LESSON: Without this, prechecks fails: "Multiple cinder-volume instances
# detected but cinder_cluster_name is not set"
cinder_cluster_name: "lab1cinder"
cinder_coordination_backend: "etcd"

# LESSON: OVN SB relay auto-enables with OVN but crashes in kolla 2025.1
# due to missing RELAY_ID env var. Not needed for <50 compute nodes.
# Do NOT use ovn_sb_db_relay_count: 0 (causes template range() error).
enable_ovn_sb_db_relay: "no"

# LESSON: Octavia uses physnet-oct for its management network.
# Must be mapped to a bridge + interface. Also requires physnet-oct
# in neutron ML2 flat_networks (see config/neutron/ml2_conf.ini).
neutron_bridge_name: "br-ex,br-oct"
neutron_external_interface: "ext0,oct0"
